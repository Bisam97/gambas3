' Gambas class file

Export

'Static Private $cMenu As New Collection

Static Public Sub FindShortcut(sText As String) As Integer

  Dim iPos As Integer
  
  Do
    iPos = String.InStr(sText, "&", iPos + 1)
    If iPos = 0 Then Break
    If String.Mid$(sText, iPos + 1, 1) = "&" Then
      Inc iPos
      Continue
    Endif
    Return iPos
  Loop
  
End

Static Public Sub _DefineShortcut(hParent As Menu)

  Dim hMenu As Menu
  Dim sText As String
  Dim cShortcut As New Collection
  Dim I As Integer
  Dim sCar As String
  Dim iPos As Integer
  'Dim hObs As Observer
  'Dim cText As Collection
  
  'Return
  
  For Each hMenu In hParent.Children
    
    sText = hMenu.Text
    If Not sText Then Continue
    
    iPos = String.InStr(sText, "&")
    If iPos Then 
      cShortcut[String.UCase(String.Mid$(sText, iPos + 1, 1))] = True
      Continue
    Endif
    
    For I = 1 To String.Len(sText)
      
      sCar = String.UCase(String.Mid$(sText, I, 1))
      
      If Len(sCar) = 1 And If Not IsLetter(sCar) And If Not IsDigit(sCar) Then Continue
      
      If Not cShortcut.Exist(sCar) Then
        
        ' If Not hObs Then
        '   hObs = New Observer(hParent) As "Menu"
        '   cText = New Collection
        '   '$cMenu[Object.Address(hParent)] = cText
        ' Endif
        
        hMenu.Text = String.Left(sText, I - 1) & "&" & String.Mid$(sText, I)
        hMenu._Text = sText
        cShortcut[sCar] = True
        
        Break
      Endif
    Next
    
    'If hMenu.Children.Count Then _DefineShortcut(hMenu)
    
  Next
  
End

Static Public Sub _Quit()

  Drag.Icon = Null
  
End

' Static Private Sub RemoveShortcut(sText As String) As String
' 
'   Dim iPos As Integer
'   
'   iPos = FindShortcut(sText)
'   If iPos Then sText = String.Left(sText, iPos - 1) & String.Mid(sText, iPos + 1)
'   Return sText
'   
' End

Static Public Sub _InitMenuBarShortcut(hWindow As Window)

  Dim hMenu As Menu
  Dim bVisible As Boolean
  Dim sText As String
  
  bVisible = hWindow.Menus.Visible

  For Each hMenu In hWindow.Menus
    
    If Not hMenu.Text Then Continue
    
    If bVisible Then
      If hMenu._Text Then
        hMenu.Text = hMenu._Text
      Endif
    Else 
      If Not hMenu._Text Then
        sText = hMenu.Text
        hMenu.Text = " "
        hMenu._Text = sText
      Endif
    Endif
    
  Next
  
End
