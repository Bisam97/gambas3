' Gambas class file

Export
Create Private 
Inherits ReportFrame

Public Const _IsContainer As Boolean = True
Public Const _Group As String = "Container"
Public Const _Properties As String = "*,Spacing"

Private $aChild As New Object[]
Private $fSpacing As Float
'PRIVATE $fPadding AS Float
Private $sSpacingUnit As String
'PRIVATE $sPaddingUnit AS String
Private $bRelativeSpacing As Boolean
Property Read Children As Object[]
Property Spacing As String
'PROPERTY Padding AS String
Property Read _Spacing As Float
'PROPERTY READ _Padding AS Float
Property Read _RelativeSpacing As Boolean

Public _RealSpacing As Integer

Public Function _Add(cControl As ReportControl) As TControl
  Dim hTControl As New TControl
  
  hTControl.Ctrl = cControl
  $aChild.Add(hTControl)
  ReportControl._ObjectFromId[cControl.Id] = cControl
  Return hTControl
End

Public Sub _Remove(id As Integer)
  
  $aChild.Remove($aChild.Find(ReportControl._ObjectFromId[id]))
  
End


Public Sub _Free()
  
  Dim hCtrl As Object
  For Each hCtrl In $aChild
    Try ReportControl._ObjectFromId.Remove(hCtrl.Ctrl.Id)
    'hctrl = NULL
  Next 
  $aChild.Clear
    
End

Private Function Children_Read() As Object[]

  Return $aChild

End


Private Function Spacing_Read() As String

  Return Units.CmToUnit($fSpacing, $sSpacingUnit) & " " & $sSpacingUnit

End

Private Sub Spacing_Write(Value As String)

  Dim hSizeParse As TSizeParse
  hSizeParse = MTools.ScanValue(value)
  If Units.AllowedUnits.Find(hSizeParse.Unit) = -1 And If hSizeParse.Unit <> "%" Then error.Raise("Unknown unit")
  If hSizeParse.Unit = "%" Then 
    $fSpacing = hSizeParse.Value
    $bRelativeSpacing = True
  Else 
    $fSpacing = Units.UnitToCm(hSizeParse.Value, hSizeParse.Unit)
    $sSpacingUnit = hSizeParse.Unit
    $bRelativeSpacing = False
  Endif
End

' PRIVATE FUNCTION Padding_Read() AS String
' 
'   RETURN Units.CmToUnit($fPadding, $sPaddingUnit) & " " & $sPaddingUnit
' 
' END

' ' PRIVATE SUB Padding_Write(Value AS String)
' ' DIM hSizeParse AS TSizeParse
' '   hSizeParse = MRTools.ScanValue(value)
' '   IF NOT Units.AllowedUnits.Find(hSizeParse.Unit) = -1 THEN error.Raise("Unknown unit")
' '   $fPadding = Units.UnitToCm(Value, hSizeParse.Unit)
' '   $sPaddingUnit = hSizeParse.Unit
' ' 
' END

Public Sub _DrawBefore(Page As Integer, X As Integer, Y As Integer, hControl As TControl, VirtualId As Integer)
  Dim hChild As Object
  Dim vi As Integer
  
  Super._DrawBefore(Page, X, Y, hControl, VirtualId)
  For Each hChild In Me.Children
    
    vi = VirtualId
    If hControl.VirtualId > -1 Then vi = hControl.VirtualId
    'Draw Before
    If hChild.RelPage = -1 Then        
     hChild.ctrl._DrawBefore(Page, X + hControl.RealLeft, Y + hControl.RealTop, hChild, vi)
    Else If hChild.RelPage + hControl.RealPage = Page Then 
      hChild.ctrl._DrawBefore(Page, X + hControl.RealLeft, Y + hControl.RealTop, hChild, vi)
    Endif 
  
  Next
  
End

Public Sub _Draw(Page As Integer, X As Integer, Y As Integer, hControl As TControl, VirtualId As Integer)
  Dim hChild As Object
  Dim vi As Integer

  For Each hChild In Me.Children
  vi = VirtualId
  If hControl.VirtualId > -1 Then vi = hControl.VirtualId
  
    If hChild.RelPage = -1 Then        
     hChild.ctrl._Draw(Page, X + hControl.RealLeft, Y + hControl.RealTop, hChild, vi)
    Else If hChild.RelPage + hControl.RealPage = Page Then 
      hChild.ctrl._Draw(Page, X + hControl.RealLeft, Y + hControl.RealTop, hChild, vi)
    Endif 
  Next 
  
End

Public Sub _DrawAfter(Page As Integer, X As Integer, Y As Integer, hControl As TControl, VirtualId As Integer)
  Dim hChild As TControl
  Dim vi As Integer
  Super._DrawAfter(Page, X, Y, hControl, VirtualId)
  For Each hChild In Me.Children
    'Draw After
    If hChild.RelPage = -1 Then        
     hChild.ctrl._DrawAfter(Page, X + hControl.RealLeft, Y + hControl.RealTop, hChild, vi)
    Else If hChild.RelPage + hControl.RealPage = Page Then 
      hChild.ctrl._DrawAfter(Page, X + hControl.RealLeft, Y + hControl.RealTop, hChild, vi)
    Endif 
  Next
  
End



Private Function _Spacing_Read() As Float

  Return $fSpacing

End

' ' PRIVATE FUNCTION _Padding_Read() AS Float
' ' 
' '   RETURN $fPadding
' ' 
' END

Private Function _RelativeSpacing_Read() As Boolean

  Return $bRelativeSpacing

End
