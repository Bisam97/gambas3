' Gambas class file
Static Private $hreport As Report
Private $fScale As Float = 1
'Private hPrinter As New Printer
Static Public Function Run(hReport As Report)
  Dim hFPreview As FPreview
  $hreport = hReport
  
  hFpreview = New FPreview
  hFpreview.Show
  
End


Public Sub _New()
  
  Me.Center
  
  
End


Public Sub ToolButton1_Click()

  Me.Close

End

Public Sub DrawingArea1_Draw()

  $hreport.Scale = $fScale
  $hreport.Paint(1)

End

Public Sub Form_Open()

  If $hreport = Null Then Me.Close
  
  ComboBox1.List = ["A3", "A4", "A5", "B5", "Executive", "Legal", "Letter", "Custom"]
  ComboBox1.Index = 1
  btnAdjust.Value = True
  'Resize
  Printer1.OutputFile = User.Home &/ "output.pdf"
  
End

Public Sub Slider1_Change()
  
  If Not btnAdjust.tag Then btnAdjust.Value = False
  Resize
  
End


Public Sub Resize()
  Dim iWidth, iHeight As Integer
  Dim fratio As Float
  
  
  iWidth = Printer1.PaperWidth * Desktop.Resolution / 25.4
  iHeight = Printer1.PaperHeight * Desktop.Resolution / 25.4
  
  If btnAdjust.Value Then
    
    If Printer1.PaperWidth > Printer1.PaperHeight Then
      $fScale = (ScrollView1.ClientW - 20) / iWidth
    Else
      $fScale = (ScrollView1.ClientH - 20) / iHeight
    Endif
    
  Else
    $fScale = Slider1.Value / 100
  Endif
  DrawingArea1.Resize(iWidth * $fScale, iHeight * $fScale)
  DrawingArea1.Refresh

End


Public Sub ComboBox1_Click()
   
  Printer1.Paper = Object.GetProperty(Printer, ComboBox1.Text)
  
  If ComboBox1.Text = "Custom" Then 
    Frame3.Enabled = True
  Else 
    Frame3.Enabled = False
    txtWidth.Text = Int(Printer1.PaperWidth)
    txtHeight.Text = Int(Printer1.PaperHeight)
  Endif
  '$hreport.Layout
  'Slider1_Change
End

Public Sub ComboBox2_Click()

  Printer1.Orientation = ComboBox2.Index
  ComboBox1_Click
  Resize

End

Public Sub txtWidth_Change()

  Printer1.PaperWidth = txtWidth.Text

  Resize
  
  Catch
  

End

Public Sub txtHeight_Change()

    Printer1.PaperHeight = txtHeight.Text
  Resize

End

Public Sub ToolButton2_Click()

  Try Dec Slider1.Value

End

Public Sub ToolButton3_Click()

  Try Inc Slider1.Value

End

Public Sub Button1_Click()

  Printer1.Print()

End



Public Sub Printer1_Draw()

  $hreport.Paint(1)

End

Public Sub Printer1_Begin()

  $hreport.Layout
  Printer1.Count = $hreport.Count

End

Public Sub Form_Resize()

  Resize

End

Public Sub btnAdjust_Click()
  btnAdjust.Tag = 1
  Resize
  Slider1.Value = $fScale * 100
  btnAdjust.Tag = Null
End

Public Sub btnZNorm_Click()
  btnAdjust.Value = False
  Slider1.Value = 100

End
