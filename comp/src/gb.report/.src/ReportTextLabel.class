' Gambas class file

Export
Inherits ReportFrame
Private $bWordWrap As Boolean
Property WordWrap As Boolean
Private $sText As String
Private $iAlignment As Integer '= Align.Center
Private $fZoom As Float
Property Text As String

Property Alignment As Integer


Private Function WordWrap_Read() As Boolean

  Return $bWordWrap

End

Private Sub WordWrap_Write(Value As Boolean)

  $bWordWrap = Value

End


Private Function Text_Read() As String

  Return $sText

End

Private Sub Text_Write(Value As String)

  $sText = Value

End

Private Function Alignment_Read() As Integer

  Return $iAlignment

End

Private Sub Alignment_Write(Value As Integer)

  $iAlignment = Value

End


Public Sub _GetSizeHints(AvailableW As Float, AvailableH As Float, TotalWidth As Float, TotalHeight As Float) As TSizeHint

  Dim hMyHints As New TSizeHint
  Dim fTextHeight As Float
  Dim fTextWidth As Float
  $fZoom = 1.0
  
  hMyHints.Height = Me._Height + (2 * Me._Padding)
  
  
  If Not IsNull(Me.Font) Then Paint.Font = Me.Font
  draw.Font.size = draw.Font.size
 
  If Me._Width = 0 Then 
    hMyHints.Width = AvailableW
  Else  
    hMyHints.Width = Me._Width 
  Endif

  If Me._RelativeWidth Then hMyHints.Width = TotalWidth * Me._Width / 100
  If hMyHints.Width > AvailableW Then hMyHints.Width = AvailableW

  fTextHeight = MRTools.PixelsToUnits(Paint.RichTextHeight($sText, MRTools.UnitsToPixels(hMyHints.Width)))
  
  If hMyHints.Height < fTextHeight Then hMyHints.Height = fTextHeight + (2 * Me._Padding)
  
  Return hMyHints
  
End

Public Sub _Draw(Page As Integer, X As Integer, Y As Integer, hControl As TControl, VirtualId As Integer)
  '$fZoom = MRTools.ReportZoom
  Paint.Brush = Paint.Color(Me.BorderColor)
  
  'Set the Font if it is initialized
  If Not IsNull(Me.Font) Then Paint.Font = Me.Font
  'draw.Font.size = draw.Font.size * MRTools.ReportZoom '* MRTools.ResolutionAffichage
  
  'Draw.Clip((x + hControl.RealLeft + MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, (y + hControl.RealTop + MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, hControl.RealWidth * MRTools.ReportZoom, hControl.RealHeight * MRTools.ReportZoom)
    Paint.Text($sText, (x + hControl.RealLeft + MRTools.UnitsToPixels(Me.Padding)), (y + hControl.RealTop + MRTools.UnitsToPixels(Me.Padding)), (hControl.RealWidth - 2 * MRTools.UnitsToPixels(Me.Padding)), (hControl.RealHeight - 2 * MRTools.UnitsToPixels(Me.Padding))) ', $iAlignment)
    'Draw.RichText($sText, (x + hControl.RealLeft + MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, (y + hControl.RealTop + MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, (hControl.RealWidth - 2 * MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, (hControl.RealHeight - 2 * MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom) ', $iAlignment)
  'Draw.Clip.Enabled = False
End
