' Gambas class file

Export
Inherits ReportFrame

Private $hSvgImage As SvgImage
Private $bStretch As Boolean
'Private $sPath As String
Public Const _Properties As String = "*,Stretch,Image{SvgImage}"
Public Const _Similar As String = "ReportTextLabel"

Property Image As SvgImage
Property Stretch As Boolean

Public Sub _GetSizeHints(AvailableW As Float, AvailableH As Float, TotalWidth As Float, TotalHeight As Float) As TSizeHint

  Dim hMyHints As New TSizeHint
  Dim h As Float = IIf(Me._Height > AvailableH, AvailableH, Me._Height)
  Dim w As Float = IIf(Me._Width > AvailableW, AvailableW, Me._Width)
  Dim Scale As Float

  hMyHints = Super._GetSizeHints(AvailableW, AvailableH, TotalWidth, TotalWidth)

  If Me.Autoresize Then
    If h < w Then
      Scale = $hSvgImage.Width / $hSvgImage.Height
      hMyHints.Width = (hMyHints.Height * Scale)
      hMyHints.Height = hMyHints.Height
    Else
      Scale = $hSvgImage.Height / $hSvgImage.Width
      hMyHints.Height = (hMyHints.Width * Scale)
      hMyHints.Width = hMyHints.Width
    Endif

  Endif
  Return hMyHints

End

Public Sub _Paint(Page As Integer, X As Float, Y As Float, hControl As TControl, VirtualId As Integer)

  Dim iX, iY, iW, iH As Integer

  iX = (x + hControl.RealLeft + MTools.UnitsToPixels(Me.Padding._Left + Me.Border._Left))
  iY = (y + hControl.RealTop + MTools.UnitsToPixels(Me.Padding._Top + Me.Border._Top))
  iW = (hControl.RealWidth - MTools.UnitsToPixels(Me.Padding._Left + Me.Padding._Right + Me.Border._Left + Me.Border._Right))

  iH = (hControl.RealHeight - MTools.UnitsToPixels(Me.Padding._Top + Me.Padding._Bottom + Me.Border._Top + Me.Border._Bottom))

  Paint.MoveTo(ix, iY)
  $hSvgImage.Width = iW
  $hSvgImage.Height = iH
  $hSvgImage.Paint
  'Draw.Drawing($hDrw, (x + hControl.RealLeft + Me.Padding) * MRTools.ReportZoom,
  '(y + hControl.RealTop + Me.Padding) * MRTools.ReportZoom,
  'hControl.RealWidth * MRTools.ReportZoom, '
  'hControl.RealHeight * MRTools.ReportZoom)

End

Private Function Image_Read() As SvgImage

  Return $hSvgImage

End

Private Sub Image_Write(Value As SvgImage)

  $hSvgImage = Value

End

Private Function Stretch_Read() As Boolean

  Return $bStretch

End

Private Sub Stretch_Write(Value As Boolean)

  $bStretch = Value

End
