' Gambas class file
Export
Inherits ReportControl


Private $hPic As Image
Private $sPath As String

Property Path As String

Private Function Path_Read() As String

  Return $sPath

End

Private Sub Path_Write(Value As String)

  If Exist(Value) Then
    $sPath = Value
    $hPic = Image.Load(Value)
  Else 
    Error.Raise("Cannot find this file !")
  Endif
  
End

Public Sub _GetSizeHints(AvailableW As Float, AvailableH As Float, TotalWidth As Float, TotalHeight As Float) As TSizeHint

  Dim hMyHints As New TSizeHint
  Dim h As Float = Me._Height
  Dim w As Float = Me._Width
  Dim Scale As Float
  If h > 0 Or w > 0 Then
    
    If h > w Then 
      Scale = $hpic.Width / $hpic.Height
      hMyHints.Width = (h * Scale) + (2 * Me._Padding)
      hMyHints.Height = h + (2 * Me._Padding)
    Else 
      Scale = $hpic.Height / $hpic.Width
      hMyHints.Height = (w * Scale) + (2 * Me._Padding)
      hMyHints.Width = w + (2 * Me._Padding)
    Endif
  Else 
    hMyHints.Height = AvailableH + (2 * Me._Padding)
    hMyHints.Width = AvailableW + (2 * Me._Padding)
  Endif
  
  Return hMyHints
  
End

Public Sub _Paint(Page As Integer, X As Integer, Y As Integer, hControl As TControl, VirtualId As Integer)
    
    Dim ix, iy As Integer
    
    ix = x + hControl.RealLeft + MTools.UnitsToPixels(Me.Padding)
    iy = y + hControl.RealTop + MTools.UnitsToPixels(Me.Padding)
    
    $hPic = $hPic.Stretch(hControl.RealWidth, hControl.RealHeight)
    
    Paint.Brush = Paint.Image($hpic, ix, iy)
    Paint.Rectangle((x + hControl.RealLeft + MTools.UnitsToPixels(Me.Padding)), (y + hControl.RealTop + MTools.UnitsToPixels(Me.Padding)), hControl.RealWidth, hControl.RealHeight)
    
    Paint.Fill
    
    'Draw.Picture($hPic, (x + hControl.RealLeft + MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, (y + hControl.RealTop + MRTools.UnitsToPixels(Me.Padding)) * MRTools.ReportZoom, hControl.RealWidth * MRTools.ReportZoom, hControl.RealHeight * MRTools.ReportZoom)

End

