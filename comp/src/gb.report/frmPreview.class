' Gambas class file

Static Private $hReport As Report 
Private colDa As New Object[]
Static Public Sub Run(hReport As Report)
  
  Dim hFrm As frmPreview
  $hReport = hReport
  hFrm = New frmPreview
  hfrm.ShowModal
  
End



Public Sub Form_Open()
Dim da As New DrawingArea(Me)
Dim pan As Panel
Dim PageLabel As Label
Dim i As Integer
Dim fZoom As Float = 0.1
'da.Resize(MRTools.UnitsToPixels($hReport.Width) * fZoom, MRTools.UnitsToPixels($hReport.Height) * fZoom)
$hReport.Resolution = Desktop.Resolution
Draw.Begin(da)
$hReport.Zoom = fZoom
'MRTools.ReportZoom = fZoom
$hReport.layout()
draw.end
da.Delete
lblTotPages.Text = " / " & $hReport.count
For i = 1 To $hReport.count
  pan = New Panel(ListContainer1)
  
  da = New DrawingArea(pan) As "daThumbs"
  da.Resize(MRTools.UnitsToPixels($hReport.Width) * fZoom, MRTools.UnitsToPixels($hReport.Height) * fZoom)
  pan.Height = da.Height + 10
  da.Move((pan.Width - da.w) / 2, 5)
  da.Show
  da.BackGround = color.White
  da.Cached = True
  PageLabel = New Label(da)
  PageLabel.BackGround = color.LightGray
  PageLabel.Text = i
  PageLabel.Height = 6
  'PageLabel.Font = font["-1"]
  PageLabel.AutoResize = True
  PageLabel.Border = Border.Plain
  draw.Begin(da)
    $hReport.draw(i)
  draw.end
  'da.Tag = i
  'colDa.Add(da)
Next  
ListContainer1.Index = 0
ListContainer1_Click
End

Public Sub daThumbs_MouseUp()
  
  
  
  
End


Public Sub ListContainer1_Click()

    Dim fZoom As Float
  'message("ok")
   fZoom = (ScrollView2.ClientWidth - 20) / MRTools.UnitsToPixels($hReport.Width)
  darep.Resize(MRTools.UnitsToPixels($hReport.Width) * fZoom, MRTools.UnitsToPixels($hReport.Height) * fzoom)
  darep.Cached = True
  darep.BackGround = color.White
  $hReport.Zoom = fZoom
  draw.Begin(darep)
    $hReport.Draw(ListContainer1.Index + 1)
  draw.end
  txtCurPage.Text = ListContainer1.Index + 1

End

Public Sub txtCurPage_KeyPress()

If key.Code <> key.Return Then Return 
If Val(txtCurPage.text) < 1 Or Val(txtCurPage.Text) > ListContainer1.count Then 
  
  Balloon.Error("You must to give a Valid page number.", Last)
  txtCurPage.Text = ListContainer1.Index + 1
Else
    ListContainer1.Index = Val(txtCurPage.text) - 1
    
Endif

Catch
End



Public Sub ToolButton1_Click()

If Not Printer.Setup() Then 
  $hReport.Orientation = Printer.Orientation
  $hReport.Size = Printer.Size
  
  ListContainer1.Clear
  Form_Open
  
Endif

End

Public Sub Form_Resize()

  ListContainer1_Click  

End

Public Sub ToolButton2_Click()

  Dim i As Integer
  Inc Application.Busy
  draw.Begin(Printer)
  $hReport.Zoom = 1
  $hReport.Resolution = Printer.Resolution
  $hReport.layout

  For i = 1 To $hReport.count
    $hReport.Draw(i)
    If i < Report.count Then Printer.NewPage  
  Next
  draw.End
  Dec Application.Busy
End
