' Gambas class file

Public ButtonPanel As Panel
Public DataView As DataView

Private $hSrc As DataSource
'PRIVATE $iIndex AS Integer
Private $bLock As Boolean
Private $iOrientation As Integer
Private $W As Integer

Public Sub _new()
  
  ButtonPanel = panBrowser
  DataView = dvwBrowser
  dvwBrowser.Header = GridView.Horizontal
  $W = btnNew.W
  SetOrientation(Align.Bottom)
  Update
  
End


Public Sub btnPrev_Click()

  'DIM hSrc AS DataSource = Common.GetSource(ME)
  'IF NOT hSrc THEN RETURN
  If $hSrc.MovePrevious() Then Return
  dvwBrowser.MovePrevious
  'DEC $iIndex

End

Public Sub btnFirst_Click()

  'DIM hSrc AS DataSource = Common.GetSource(ME)
  'IF NOT hSrc THEN RETURN
  If $hSrc.MoveFirst() Then Return
  dvwBrowser.MoveFirst
  '$iIndex = 0

End

Public Sub btnNext_Click()

  'DIM hSrc AS DataSource = Common.GetSource(ME)  
  'IF NOT hSrc THEN RETURN
  If $hSrc.MoveNext() Then Return
  dvwBrowser.MoveNext
  'INC $iIndex

End

Public Sub btnLast_Click()

  'DIM hSrc AS DataSource = Common.GetSource(ME)
  'IF NOT hSrc THEN RETURN
  If $hSrc.MoveLast() Then Return
  dvwBrowser.MoveLast
  '$iIndex = dvwBrowser.Count - 1

End

Public Sub btnSave_Click()

  dvwBrowser.Save
  $hSrc.Save

End

Public Sub _OnDatabaseChange()
  
  dvwBrowser._OnDatabaseChange
  
End


Public Sub Update()

  Dim bEnabled As Boolean  
  Dim bVisible As Boolean
  
  $hSrc = Common.GetSource(Me)
  If $hSrc Then
    bEnabled = True '$hSrc.Index >= 0
    bVisible = Not $hSrc.ReadOnly
  Endif

  btnFirst.Enabled = bEnabled
  btnNext.Enabled = bEnabled
  btnPrev.Enabled = bEnabled
  btnLast.Enabled = bEnabled
  btnSave.Enabled = bEnabled
  btnRemove.Enabled = bEnabled
  btnReload.Enabled = bEnabled
  btnNew.Enabled = $hSrc
  
  btnSave.Visible = bVisible
  btnNew.Visible = bVisible
  btnRemove.Visible = bVisible
  
  dvwBrowser.Update
  
  If $hSrc And If Not bVisible Then btnFirst_Click
  
End

Public Sub btnReload_Click()

  'DIM hSrc AS DataSource = Common.GetSource(ME)  
  'IF NOT hSrc THEN RETURN
  $hSrc.Cancel

End

Public Sub btnNew_Click()

  'DIM hSrc AS DataSource = Common.GetSource(ME)  
  'IF NOT hSrc THEN RETURN
  $hSrc.Create
  dvwBrowser.Create
  '$iIndex = -1

End

Public Sub Form_Resize()

  dvwBrowser.Visible = Me.Height > 48
  panBrowser.Expand = Not dvwBrowser.Visible

End

Public Sub dvwBrowser_Activate()

  If $hSrc.MoveTo(dvwBrowser.Index) Then
    dvwBrowser.MoveTo($hSrc.Index)
  Endif

End

Public Sub btnRemove_Click()

  $hSrc.Remove
  dvwBrowser.Remove

End

Public Sub GetOrientation() As Integer
  
  Return $iOrientation
  
End

Public Sub SetOrientation(iOrientation As Integer)
  
  If $iOrientation = iOrientation Then Return 
  
  Select Case iOrientation
    Case Align.Top
      Me.Arrangement = Arrange.Vertical
      panBrowser.Next = dvwBrowser
      panBrowser.Arrangement = Arrange.Horizontal
      panBrowser.H = $W
    Case Align.Bottom
      Me.Arrangement = Arrange.Vertical
      panBrowser.Previous = dvwBrowser
      panBrowser.Arrangement = Arrange.Horizontal
      panBrowser.H = $W
    Case Align.Left
      Me.Arrangement = Arrange.Horizontal
      panBrowser.Next = dvwBrowser
      panBrowser.Arrangement = Arrange.Vertical
      panBrowser.W = $W
    Case Align.Right
      Me.Arrangement = Arrange.Horizontal
      panBrowser.Previous = dvwBrowser
      panBrowser.Arrangement = Arrange.Vertical
      panBrowser.W = $W
    Default 
      Return
  End Select
  
  $iOrientation = iOrientation
  
End
