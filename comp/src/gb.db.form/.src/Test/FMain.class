' Gambas class file

Public Sub _new()

End

Private TestDir As String
Private Country As String
Private CountryIndex As Integer

'''
''' Form
'''

Public Sub Form_Open()

  Inc Application.Busy

  Me.Center()

  'Dialog.Path = Application.Path
  'Dialog.Title = "Choose the SQLite3 database file's directory"
  'Dialog.SelectDirectory()
  'Dialog.ShowHidden = False
  TestDir = "/home/benoit/gambas/3.0/issues/221/Test/" 'Application.Path

  ' Open database
  ' 
  ' Use something like this for a SQLite3 database
  MDatabase.OpenDatabase("sqlite3", TestDir, "Test.db", "", "")
  '
  ' Use something like this for a MySQL database
  'MDatabase.OpenDatabase("mysql", "", Application.Name, "root", "")
  '
  ' Use something like this for a PostgreSQL database
  'MDatabase.OpenDatabase("postgresql", "", Application.Name, "postgres", "")
  ' 
  ClearComboBoxCountry()
  PopulateComboBoxCountry()
  Me.Show()
  
  ComboBoxCountry.Index = 0
  'DB.Debug = True
  ButtonCountryMaintenance_Click
  '
Finally
  
  Dec Application.Busy
  
Catch
  Message.Warning(ERROR.Text & "\n" & Error.Where)
End

Public Sub Form_Close()
  Inc Application.Busy
  MDatabase.CloseDatabase()
Finally
  Dec Application.Busy
End


'''
''' Controls
'''

Public Sub ComboBoxCountry_Click()
  CountryIndex = Last.Index
  Country = Last.Text
End

Public Sub ButtonCountryMaintenance_Click()
  Dim hForm As FCountryMaintenance
  hForm = New FCountryMaintenance
  hForm.DataSourceCountry.Connection = MDatabase.DatabaseConnection
  hForm.DataSourceCountry.Table = "country"
  hForm.DataSourceCountry.Update()
  'hForm.Refresh()
  hForm.DataBrowserCountry.Columns = ["country"]
  hForm.DataBrowserCountry.Labels = ["Country"]
  hForm.DataBrowserCountry.Editable = True
  hForm.DataBrowserCountry.Update()
  hForm.DataBrowserCountry.Refresh()
  hForm.Show() 
  hForm.DataBrowserCountry.SetFocus()
End

Public Sub ButtonExit_Click()
  Me.Close()
End

'''
''' Procedures & Functions
'''

Public Procedure ClearComboBoxCountry()
  With ComboBoxCountry
    .Enabled = False
    .Clear()
    .Refresh()
  End With
End

Public Procedure PopulateComboBoxCountry()
  Dim country As String
  Dim countCountry As Integer
  MDatabase.SelectEachCountry
  countCountry = MDatabase.ResultCountry.Count
  If countCountry > 0 Then
    For Each MDatabase.ResultCountry
      country = MDatabase.ResultCountry!country
      ComboBoxCountry.Add(country)
    Next
    With ComboBoxCountry
      .Text = "Select Country"
      .Enabled = True
      .Refresh()
    End With
  Else
    With ComboBoxCountry
      .Enabled = False
      .Refresh()
    End With
  End If
  With ButtonCountryMaintenance
    .Enabled = True
    .Refresh()
  End With
  If countCountry > 0 Then
    ComboBoxCountry.SetFocus()
  Else
    ButtonCountryMaintenance.SetFocus()
  Endif
End

