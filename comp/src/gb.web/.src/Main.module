' Gambas module file

Public AllowLog As Boolean

Public Sub Log(sMsg As String)
  
  Dim hFile As File
  
  If Not AllowLog Then Return
  
  hFile = Open "/tmp/session.log" For Append 
  Print #hFile, sMsg
  Close #hFile
  
End

Public Sub DecodeURL(sUrl As String, aField As String[], cVal As Collection)
  
  Dim sElt As String
  Dim aElt As String[]
  Dim sKey As String
  Dim sVal As String
  Dim iPos As Integer
  Dim iPos2 As Integer
  Dim sCar As String

  sUrl = Trim(sUrl)
  
  For Each sElt In Split(sUrl, Request.Delimiter)
  
    If Not sElt Then Continue
  
    aElt = Split(sElt, "=")
    If aElt.Count = 2 Then
      sKey = CGI.Decode(aElt[0])
      If Not sKey Then Continue
      sVal = CGI.Decode(aElt[1])
    Else 
      sKey = CGI.Decode(aElt[0])
      If Not sKey Then Continue
      sVal = ""
    Endif
    
    If Not aField.Exist(sKey) Then
      aField.Add(sKey)
      cVal[sKey] = sVal
    Else If sVal Then 
      'IF TypeOf(cVal[sKey]) = gb.String THEN 
      '  cVal[sKey] = [CStr(cVal[sKey]), sVal]
      'ELSE  
      '  cVal[sKey].Add(sVal)
      'ENDIF
      cVal[sKey] &= "\n" & sVal
    Endif
  
  Next  
 
End


Public Sub Main()

  Dim hFile As File
  Dim aStr As Variant[] = ["la", ["nuit", "tous"], "les", "chats", [3, 4, 5], "sont", "gris"]
  Dim cCol As Collection = ["aspic": Pi, "camembert": aStr, "barbapapa": "Gambas !", "zut": String$(100, "Gambas")]
  
  hFile = Open "~/serialize.txt" For Create
  Write #hFile, cCol As Variant
  Close #hFile
  
  hFile = Open "~/serialize.txt" For Read
  cCol = Read #hFile As Variant
  Close #hFile
  
  Print cCol.Count
  
End
