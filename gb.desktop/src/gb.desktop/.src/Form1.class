' Gambas class file

Private _NET_CLIENT_LIST As Integer
Private _NET_WM_ICON As Integer

Public Sub Button1_Click()

  Dim aWindow As Integer[]
  Dim hWindow As Integer
  Dim aIcon As Integer[]
  Dim hImage As Image
  Dim hPictureBox As PictureBox
  Dim iCurrentDesktop As Integer
  Dim iDesktop As Integer
  
  iCurrentDesktop = _Desktop.GetWindowProperty("_NET_CURRENT_DESKTOP", _Desktop.RootWindow)[0]

  For Each hPictureBox In ScrollView1.Children
    hPictureBox.Delete
  Next

  _NET_CLIENT_LIST = _Desktop.InternAtom("_NET_CLIENT_LIST")  
  _NET_WM_ICON = _Desktop.InternAtom("_NET_WM_ICON")  
  aWindow = _Desktop.GetWindowProperty(_NET_CLIENT_LIST, _Desktop.RootWindow)
  For Each hWindow In aWindow
    iDesktop = _Desktop.GetWindowProperty("_NET_WM_DESKTOP", hWindow)[0]
    'If iDesktop <> iCurrentDesktop And If iDesktop >= 0 Then Continue
    
    aIcon = _Desktop.GetWindowProperty(_NET_WM_ICON, hWindow)
    hPictureBox = New PictureBox(ScrollView1)
    hPictureBox.Border = Border.Plain
    hPictureBox.Alignment = Align.Center
    hPictureBox.Resize(16, 16)
    If aIcon Then
      hImage = _Desktop.MakeIcon(aIcon)
      If hImage Then
        hPictureBox.Picture = hImage.Picture
        hPictureBox.Resize(hImage.W + 4, hImage.H + 4)
      Endif
    Endif
  Next


End
