' Gambas class file

Property Enabled As Boolean
Property ToolTip As String
Property Foreground As Integer

Public Tag As String

Private $hPanel As Panel
Private $hImage As PictureBox
Private $hLabel As Label
Private $iColor As Integer

Event Click()


Public Sub _new(hContainer As Container, X As Integer, Y As Integer, W As Integer, H As Integer, sText As String, vIcon As Variant, Optional sFont As String)

  Dim hPict As Picture

  $hPanel = New Panel(hContainer) As "Panel"
  $hPanel.Move(X, Y, W, H)
  $hPanel.Mouse = Mouse.Pointing
  $hPanel.Arrangement = Arrange.Horizontal
  $hPanel.Padding = 2
  $hPanel.Spacing = 8

  If TypeOf(vIcon) = gb.String Then
    hPict = Picture[vIcon]
  Else
    hPict = vIcon
  Endif

  $hImage = New PictureBox($hPanel) As "Panel"
  If hPict Then
    $hImage.Resize(hPict.Width + 4, H - 8)
    $hImage.Alignment = Align.Right
    $hImage.Picture = hPict
  Else
    $hImage.Resize(32, H - 8)
  Endif

  $hLabel = New Label($hPanel) As "Panel"
  '$hLabel.AutoResize = FALSE
  $hLabel.Expand = True
  If sFont Then $hLabel.Font = Font[sFont]
  $hLabel.Text = sText

End

Public Sub Panel_Enter()

  If Object.Type(Last) <> "Panel" Then Return
  $iColor = Last.Foreground
  Last.Background = Color.LightBackground '&88D5FF&
  Last.Foreground = Color.SelectedForeground '&88D5FF&

End

Public Sub Panel_Leave()

  If Object.Type(Last) <> "Panel" Then Return
  Last.Background = Last.Parent.Background
  Last.Foreground = $iColor

End

Private Function GetPanel() As Panel

  Dim hPanel As Panel

  Try hPanel = Last
  If Error Then
    hPanel = Last.Parent
  Endif

  Return hPanel

End


Public Sub Panel_MouseDown()

  With GetPanel()
    .Border = Border.Sunken
  End With

  '$hLabel.Move($hLabel.X + 1, $hLabel.Y + 1)
  '$hImage.Move($hImage.X + 1, $hImage.Y + 1)

End


Public Sub Panel_MouseUp()

  Dim hPanel As Panel
  Dim X As Integer
  Dim Y As Integer

  hPanel = GetPanel()
  hPanel.Border = Border.None

  X = Mouse.X
  Y = Mouse.Y

  If Last <> hPanel Then
    X = X + Last.X
    Y = Y + Last.Y
  Endif

  '$hLabel.Move($hLabel.X - 1, $hLabel.Y - 1)
  '$hImage.Move($hImage.X - 1, $hImage.Y - 1)


  If (X >= 0 And Y >= 0 And X < hPanel.W And Y < hPanel.H) Then

    Raise Click()

  Else

    'PRINT "Pas Click !"; X; " "; Y; " "; hPanel.W; " "; hPanel.H

  Endif

End


Private Function Enabled_Read() As Boolean

  Return $hPanel.Enabled

End

Private Sub Enabled_Write(bEnabled As Boolean)

  $hPanel.Enabled = bEnabled

End


Public Sub Move(X As Integer, Y As Integer)

  $hPanel.Move(X, Y)

End


Public Sub Resize(W As Integer, H As Integer)

  $hPanel.Resize(W, H)
  '$hLabel.Resize(W - ($hImage.X + $hImage.W + 8) - 8, H - 8)

End

Private Function ToolTip_Read() As String

  Return $hPanel.ToolTip

End

Private Sub ToolTip_Write(sToolTip As String)

  $hPanel.ToolTip = sToolTip
  '$hImage.ToolTip = sToolTip
  '$hLabel.ToolTip = sToolTip

End


Private Function Foreground_Read() As Integer

  Return $hPanel.Foreground

End

Private Sub Foreground_Write(Value As Integer)

  $hPanel.Foreground = Value

End
