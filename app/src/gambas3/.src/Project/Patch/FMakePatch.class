' Gambas class file

' (C) 2013 Tobias Boege <tobias@gambas-buch.de>

Public Sub wizMakePatch_BeforeChange()

  Dim sOld As String

  Select Case wizMakePatch.Index
    Case 0
      If radArchive.Value Then
        wizMakePatch[1].Enabled = True
        wizMakePatch[2].Enabled = False
      Else
        wizMakePatch[1].Enabled = False
        wizMakePatch[2].Enabled = True
      Endif
    Case 1
      If Not Exist(fchOld.SelectedPath) Or If IsDir(fchOld.SelectedPath) Then
        Message.Warning(("You must choose an old archive"))
        Stop Event
      Endif
    Case 2
      If Not IsDir(pchOld.Path) Or If Not Exist(pchOld.Path &/ ".project") Then
        Message.Warning(("You must select a valid Gambas project"))
        Stop Event
      Endif
  End Select

End

Public Sub wizMakePatch_Close()

  Dim sOld As String

  If radArchive.Value Then
    sOld = fchOld.SelectedPath
  Else
    sOld = pchOld.Path
  Endif

  Project.Save()
  File.Save(fchPatch.Value, Patch.GenerateForOld(sOld))
  Message.Info(("Patch written."))
  Me.Close()

  Catch
    Message.Error(Error.Text)

End

Public Sub wizMakePatch_Cancel()

  Me.Close()

End

Public Sub chOld_Activate()

  wizMakePatch.Index = 3

End

Public Sub fchPatch_Activate()

  wizMakePatch_Close()

End
