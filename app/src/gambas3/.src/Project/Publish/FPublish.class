' Gambas class file

Public Sub Run() As Boolean

  Return Not Me.ShowModal()

End

Public Sub btnOK_Click()

  Me.Close(True)

End

Public Sub btnCancel_Click()

  Me.Close

End

Public Sub btnPublish_Click()

  spnPublish.Enabled = True
  btnPublish.Hide
  btnCancel.Hide
  btnAbort.Show
  
  Publish.PublishSoftware(Me, txtScreenshot.Text, txtLogin.Text, txtPassword.Text, cmbGambasVersion.Text)
  
End

Public Sub SetMessage(sMsg As String)
  
  lblMessage.Text = sMsg
  
End


Public Sub OnPublishEnd()

  btnPublish.Show
  btnAbort.Hide
  btnCancel.Show
  spnPublish.Enabled = False

End

Public Sub btnAbort_Click()

  Publish.Abort

End

Public Sub txtScreenshot_Click()

  Dialog.Title = ("Select a screenshot of your project")
  Dialog.Filter = ["*.png;*.jpg;*.jpeg", ("Picture files")]
  Dialog.Path = txtScreenshot.Text
  If Dialog.OpenFile() Then Return
  
  txtScreenshot.Text = Dialog.Path

End

Public Sub Form_Open()

  cmbFarm.List = Settings["/Publish/FarmList"]
  cmbFarm.Text = Settings["/Publish/Farm"]
  txtLogin.Text = Settings["/Publish/Login"]
  chkRememberPassword.Value = Settings["/Publish/RememberPassword", False]
  If chkRememberPassword.Value Then
    Try txtPassword.Text = Desktop.Passwords["/Publish"]
  Endif
  
  tagEditor.SetTags(Project.PublishTags)
  tagRequire.SetTags(Project.PublishDependencies)

End

Public Sub Form_Close()

  Settings["/Publish/Farm"] = cmbFarm.Text
  Settings["/Publish/Login"] = txtLogin.Text
  Settings["/Publish/RememberPassword"] = CBool(chkRememberPassword.Value)
  If chkRememberPassword.Value Then
    Try Desktop.Passwords["/Publish"] = txtPassword.Text
  Endif

  Project.PublishTags = tagEditor.GetTags()
  Project.PublishDependencies = tagRequire.GetTags()
  Project.WriteProject

End

