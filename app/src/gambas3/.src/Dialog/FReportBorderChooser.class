' Gambas class file

Static Public Value As String

'Private hBrush As CReportBrush = CReportBrush["&h00000000&"]

Private Enum BORDER_TOP, BORDER_BOTTOM, BORDER_LEFT, BORDER_RIGHT

Private $aCoordBox As New CoordBox[4]
Private $aBrush As New CReportBrush[4]
Private $aWidth As New String[4]
Private $aBorder As String[] = ["Top", "Bottom", "Left", "Right"]

Private $iCurBorder As Integer

Public Sub Run(sBorder As String) As Boolean
  
  Value = sBorder
  Return Not Me.ShowModal()
  
End


' Public Sub RefreshImage()
'   'Dim $hImg As Image
' 
'   Paint.Begin($hImg)
'   Paint.Brush = hBrush._PaintBrush(4, 4, Paint.Width - 6, Paint.Height - 6)
'   Paint.Rectangle(0, 0, Paint.Width, Paint.Height)
'   Paint.Fill
'   Paint.LineWidth = 2
'   Paint.Brush = Paint.Color(Color.Black)
'   Paint.Rectangle(0, 0, Paint.Width, Paint.Height)
'   Paint.Stroke
'   paint.Brush = Paint.Color(Color.White)
'   Paint.Rectangle(2, 2, Paint.Width - 4, Paint.Height - 4)
'   Paint.Stroke
'   
'   Paint.End
'   Button1.Picture = $hImg.Picture
' 
' End

' Public Sub ButtonBox1_Click()
'   
'   If Not FReportCoordChooser.Run(Last.Text) Then Last.Text = FReportCoordChooser.Coord
'   
' End
' 
Public Sub dwgBorder_Draw()
  
  Dim iBorder As Integer
  Dim iSize As Integer
  Dim hBrush As CReportBrush

  For iBorder = 0 To 3
    
    If Not $aCoordBox[iBorder].Value = Null Then Continue
    
    If chkSynchro.Value Then
      hBrush = $aBrush[BORDER_TOP]
      iSize = CFamilyReport.ToPixel($aCoordBox[BORDER_TOP].Value)
    Else
      hBrush = $aBrush[iBorder]
      iSize = CFamilyReport.ToPixel($aCoordBox[iBorder].Value)
    Endif
    
    Select Case iBorder
      Case BORDER_TOP
        Paint.Rectangle(0, 0, Paint.Width, iSize)
        Paint.Brush = hBrush._PaintBrush(0, 0, Paint.Width, iSize)
      Case BORDER_RIGHT
        Paint.Rectangle(Paint.Width - iSize, 0, iSize, Paint.Height)
        Paint.Brush = hBrush._PaintBrush(Paint.Width - iSize, 0, Paint.Width, Paint.Height)
      Case BORDER_BOTTOM
        paint.Rectangle(0, Paint.Height - iSize, Paint.Width, iSize)
        Paint.Brush = hBrush._PaintBrush(0, Paint.Height - iSize, Paint.Width, Paint.Height)
      Case BORDER_LEFT
        Paint.Rectangle(0, 0, iSize, Paint.Height)
        Paint.Brush = hBrush._PaintBrush(0, 0, iSize, Paint.Height)
    End Select
    
    Paint.Fill
    
  Next
  
End
' 
' Public Sub dwgBorder_MouseDown()
'   
'   Dim fPosX, fPosY As Float
'   Dim iPos As Integer
'   
'   fPosX = Mouse.X / dwgBorder.Width
'   fPosY = Mouse.Y / dwgBorder.Height
'   
'   If fPosY > fPosX Then
'     If fPosY > (1 - fPosX) Then
'       iPos = 2
'     Else
'       iPos = 3
'     Endif
'   Else
'     If fPosY > (1 - fPosX) Then
'       iPos = 1
'     Else
'       iPos = 0
'     Endif
'   Endif
'   
'   If Not $aBrushes[iPos] Then
'     $aBrushes[iPos] = hBrush
'   Else
'     If $aWidth[iPos] = ButtonBox1.Text And If $aBrushes[iPos] = hBrush Then 
'       $aBrushes[iPos] = Null
'     Else
'       $aBrushes[iPos] = hBrush
'     Endif
'     
'   Endif
'   $aWidth[iPos] = ButtonBox1.Text
'   
'   'SetBorder(sWhere, Not HasBorder(sWhere))
'   dwgBorder.Refresh
'   
' End
' 
' Public Sub btnOK_Click()
'   
'   Dim bAll As Boolean = True
'   Dim prevhBrush, hBrush As CReportBrush
'   Dim PrevW As String
'   Dim i As Integer
'   
'   Value = ""
'   prevhBrush = $aBrushes[0]
'   PrevW = $aWidth[0]
'   For i = 0 To 3
'     If $aBrushes[i] = Null Or If $aBrushes[i] <> prevhBrush Or If $aWidth[i] <> PrevW Then
'       
'       bAll = False
'       Break
'     Endif
'     
'     prevhBrush = $aBrushes[i]
'     PrevW = $aWidth[i]
'     
'   Next
'   
'   If bAll Then 
'     If $aBrushes[0] <> Null Then Value = "Border=" & $aWidth[0] & " " & $aBrushes[0].ToString() & ";"
'     
'   Else
'     For i = 0 To 3
'       
'       If $aBrushes[i] Then
'         
'         Value &= $aSide[i] & "=" & $aWidth[i] & " " & $aBrushes[i].ToString() & "; "
'         
'       Endif
'       
'     Next
'   Endif
'   Me.Close(True)
'   
' End
' 
' Public Sub Form_Open()
'   
'   Dim ars As String[]
'   Dim ars2 As String[]
'   Dim iSide, i As Integer
'   Dim sValue As String
'   For Each sValue In Split(Value, ";")
'     ars = Scan(sValue, "*=*")
'     If ars.Count < 2 Then Return
'     iSide = $aSide.Find(Trim(ars[0]))
'     If iSide = -1 Then  
'       If LCase(Trim(ars[0])) <> "border" Then Return
'       For i = 0 To 3
'         ars2 = Split(ars[1], " ")
'         $aWidth[i] = ars2[0]
'         Try $aBrushes[i] = CReportBrush[ars2[1]]
'       Next 
'       
'     Else
'       ars2 = Split(ars[1], " ")
'        $aWidth[iSide] = ars2[0]
'       Try $aBrushes[iSide] = CReportBrush[ars2[1]]
'     Endif
'   Next
'   dwgBorder.Refresh
'   
' End
' 

Public Sub Form_Open()

  Dim sBorder As String
  Dim aScan As String[]
  Dim iBorder As Integer
  Dim sBrush As String
  Dim aComp As New String[4]
  
  $aCoordBox[BORDER_TOP] = crdTop
  $aCoordBox[BORDER_BOTTOM] = crdBottom
  $aCoordBox[BORDER_LEFT] = crdLeft
  $aCoordBox[BORDER_RIGHT] = crdRight
  
  For iBorder = 0 To 3
    $aCoordBox[iBorder].Clear
    $aBrush[iBorder] = New CReportBrush
  Next
  
  For Each sBorder In Split(Value, ";")
    
    aScan = Scan(sBorder, "*:*")
    If aScan.Count <> 2 Then Continue
    iBorder = $aBorder.Find(aScan[0], gb.IgnoreCase)
    If iBorder < 0 Then Continue
    
    aComp[iBorder] = aScan[1]
    
    For Each sBrush In Split(aScan[1], " ")
      
      If IsDigit(Left(sBrush)) Then
        Try $aCoordBox[iBorder].Value = sBrush
      Else
        Try $aBrush[iBorder] = CReportBrush[sBrush]
      Endif
      
    Next
    
  Next
  
  If aComp[0] = aComp[1] And If aComp[0] = aComp[2] And If aComp[0] = aComp[3] Then
    chkSynchro.Value = True
  Else
    chkSynchro.Value = False
  Endif

End

Public Sub chkSynchro_Click()

  Dim hCtrl As Control

  For Each hCtrl In [crdBottom, crdLeft, crdRight, btnBottom, btnLeft, btnRight]
    hCtrl.Enabled = chkSynchro.Value = False
  Next
  dwgBorder.Refresh

End

Public Sub btnBrush_Click()

  Dim iBorder As Integer = $aBorder.Find(Last.Tag)

  If Not FReportBrushChooser.Run($aBrush[iBorder].ToString()) Then
    $aBrush[iBorder] = CReportBrush[FReportBrushChooser.Value]
    dwgBorder.Refresh
  Endif

End

Public Sub btnCancel_Click()

  Me.Close

End

Public Sub crdBrush_Change()

  dwgBorder.Refresh

End

Public Sub btnOK_Click()

  Dim sBorder As String
  Dim iBorder As Integer
  Dim iUse As Integer
  
  For iBorder = 0 To 3
    
    iUse = If(chkSynchro.Value, BORDER_TOP, iBorder)
    
    If Not $aCoordBox[iUse].Value Then Continue
    If sBorder Then sBorder &= ";"
    sBorder &= $aBorder[iBorder] & ":"
    sBorder &= $aCoordBox[iUse].Value & " " & $aBrush[iUse].ToString()
    
  Next
  
  Value = sBorder
  Me.Close(True)

End
