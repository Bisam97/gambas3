' Gambas class file

Static Private $aSupport As String[]
Static Private $iWait As Integer
Static Private $iSupport As Integer

Static Public Sub Run()

  Dim hForm As FAbout

  hForm = New FAbout
  hForm.ShowModal

End


Public Sub Form_Open()

  Dim sText As String

  txtAuthor.BackColor = svwAuthor.BackColor

  GetVersion
  GetAuthor
  GetSupport

  txtGift.X = 0
'   panGift.ClientW
'   sText = Trim(File.Load("support.txt"))
'   txtGift.Text = "<b>" & ("Thanks to") & "</b>..." & Replace("\n" & sText, "\n", String$(8, "&nbsp;"))
'   txtGift.W = txtGift.Font.Width(Replace(sText, "\n", "        ")) + 128

End


Private Sub GetVersion()

  lblVersion.Text = Project.Version
  lblVersion.X = lblGambas.X + lblGambas.Font.Width(lblGambas.Text)

End


Public Sub btnClose_Click()

  Me.Close

End


Public Sub timAuthor_Timer()

  Dim Y As Integer

  Y = svwAuthor.ScrollY
  Inc svwAuthor.ScrollY
  If Y = svwAuthor.ScrollY Then
    svwAuthor.ScrollY = 0
  Endif

  With txtGift

    If $iWait > 0 Then
      Dec $iWait
    Else If .X > 0 Then
      .X = Max(0, .X - 8)
      If .X = 0 Then $iWait = 50
    Else
      .X = panGift.Width
      txtGift.Text = $aSupport[$iSupport]
      Inc $iSupport
      If $iSupport >= $aSupport.Count Then $iSupport = 0
    Endif

  End With

End

Private Sub RemoveLink(sStr As String) As String
  
  Dim iPos As Integer
  Dim iPos2 As Integer
  
  Do

    iPos = InStr(sStr, "<a href=")
    If iPos = 0 Then Break

    iPos2 = InStr(sStr, ">", iPos)
    If iPos2 = 0 Then iPos2 = Len(sStr) + 1
    sStr = Left(sStr, iPos - 1) & Mid(sStr, iPos2 + 1)
    
  Loop
  
  Return Replace(sStr, "</a>", "")
  
End


Private Sub GetAuthor()

  Dim hFic As File
  Dim sText As String
  Dim sLig As String
  Dim nLig As Integer
  Dim sMail As String
  Dim sCountry As String

  hFic = Open "authors.txt"

  While NOT Eof(hFic)

    Line Input #hFic, sLig
    If NOT sLig Then Continue
    If Left(sLig) = "-" Then Continue

    Line Input #hFic, sMail
    Line Input #hFic, sCountry
    
    sText &= "<p><font size=+1><b>" & sLig & "</b>"
    If sCountry Then sText &= " (" & sCountry & ")"
    sText &= "</font></p><blockquote>\n"
    
    sText &= "<u>" & sMail & "</u><br>"

    While NOT Eof(hFic)

      Line Input #hFic, sLig
      If NOT sLig Then Continue
      If Left(sLig) = "-" Then Break
      
      sLig = RemoveLink(sLig)
      If Right(sLig) <> "." Then sLig &= "."
      sText &= sLig & "<br>"

    Wend

    'IF Right$(sText, 4) = "<br>" THEN sText = Left$(sText, -4)

    sText = sText & "</blockquote>\n"

  Wend

  Close #hFic

  txtAuthor.RichText = sText
  'nLig * txtAuthor.Font.Height("a") * 0.95 + 256

Finally

  txtAuthor.Height = txtAuthor.TextHeight '+ 256
  'PRINT txtAuthor.TextHeight

Catch

  txtAuthor.RichText = Error.Text

End

Private Sub GetSupport()

  Dim iInd As Integer

  $aSupport = Split(Trim(File.Load("support.txt")), "\n")

  For iInd = 0 To $aSupport.Count - 1

    $aSupport[iInd] = "<b>" & $aSupport[iInd] & "...</b>"

  Next

  $aSupport.Add("<b>" & ("Thanks to") & "...</b>", 0)

End


Public Sub Form_Show()

  txtAuthor.Height = txtAuthor.TextHeight + 256

End

Public Sub btnGift_Click()

  Project.OpenWebPage("https://www.paypal.com/xclick/business=gambas%40users.sourceforge.net&no_note=1&tax=0&currency_code=EUR")

End
