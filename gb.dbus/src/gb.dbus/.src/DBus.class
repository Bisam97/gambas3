' Gambas class file

Export

Static Property Read System As DBusConnection
Static Property Read Session As DBusConnection

Static Public _ApplicationCache As New Collection

Static Private $iApp As Integer

Static Public Sub _get(Application As String) As DBusApplication
  
  Dim hConn As DBusConnection
  Dim hApp As DBusApplication
  Dim sKey As String
  
  If Application Like "system://*" Then
    sKey = Application
    Application = Mid$(Application, 10)
    hConn = _DBus.System
  Else If Application Like "session://*" Then
    sKey = Application
    Application = Mid$(Application, 11)
    hConn = _DBus.Session
  Else
    sKey = "session://" & Application
    hConn = _DBus.Session
  Endif
  
  hApp = _ApplicationCache[sKey]
  If Not hApp Then hApp = New DBusApplication(hConn, Application)
  Return hApp
  
End

Static Private Function System_Read() As DBusConnection

  Return _DBus.System

End

Static Private Function Session_Read() As DBusConnection

  Return _DBus.Session

End
